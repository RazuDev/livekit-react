(this["webpackJsonplivekit-react-example"]=this["webpackJsonplivekit-react-example"]||[]).push([[0],{103:function(e,t,n){"use strict";n.r(t);n(63);var a=n(0),r=n.n(a),c=n(57),i=n.n(c),o=(n(68),n(29)),l=n(2),u=n(16),s=n(1),d=n(59),m=function(e){var t=e.track,n=e.isLocal,r=Object(a.useRef)();return Object(a.useEffect)((function(){if(!n)return r.current=t.attach(),t.sid&&r.current.setAttribute("data-audio-track-id",t.sid),function(){return t.detach().forEach((function(e){return e.remove()}))}}),[t,n]),null},f="_2WNzJ",v="_34YL4",b="_1k1qr",k="_2kKks",p="_hRq5k",h=function(e){var t=e.label,n=e.disabled,a=e.onClick;return r.a.createElement("button",{disabled:n,className:p,onClick:a},t)};"undefined"!==typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!==typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));function E(e,t){try{var n=e()}catch(a){return t(a)}return n&&n.then?n.then(void 0,t):n}function O(e){var t=Object(a.useState)(!1),n=t[0],r=t[1],c=Object(a.useState)(!1),i=c[0],o=c[1],l=Object(a.useState)(),u=l[0],d=l[1],m=Object(a.useState)([]),f=m[0],v=m[1],b=Object(a.useState)([]),k=b[0],p=b[1],h=Object(a.useCallback)((function(){v(Array.from(e.tracks.values())),p(Array.from(e.tracks.values()).filter((function(e){return void 0!==e.track})))}),[]),E=Object(a.useCallback)((function(t){try{if(!(e instanceof s.LocalParticipant))throw new Error("could not unpublish, not a local participant");return e.unpublishTrack(t),h(),Promise.resolve()}catch(n){return Promise.reject(n)}}),[]);return Object(a.useEffect)((function(){var t=function(e){e.kind===s.Track.Kind.Audio&&r(!0)},n=function(e){e.kind===s.Track.Kind.Audio&&r(!1)},a=function(){e.metadata&&d(e.metadata)},c=function(){o(e.isSpeaking)};return e.on(s.ParticipantEvent.TrackMuted,t),e.on(s.ParticipantEvent.TrackUnmuted,n),e.on(s.ParticipantEvent.MetadataChanged,a),e.on(s.ParticipantEvent.IsSpeakingChanged,c),e.on(s.ParticipantEvent.TrackPublished,h),e.on(s.ParticipantEvent.TrackUnpublished,h),e.on(s.ParticipantEvent.TrackSubscribed,h),e.on(s.ParticipantEvent.TrackUnsubscribed,h),a(),c(),h(),e.audioTracks.forEach((function(e){r(e.isMuted)})),function(){e.off(s.ParticipantEvent.TrackMuted,t),e.off(s.ParticipantEvent.TrackUnmuted,n),e.off(s.ParticipantEvent.MetadataChanged,a),e.off(s.ParticipantEvent.IsSpeakingChanged,c),e.off(s.ParticipantEvent.TrackPublished,h),e.off(s.ParticipantEvent.TrackUnpublished,h),e.off(s.ParticipantEvent.TrackSubscribed,h),e.off(s.ParticipantEvent.TrackUnsubscribed,h)}}),[]),{isLocal:e instanceof s.LocalParticipant,isSpeaking:i,isMuted:n,publications:f,subscribedTracks:k,metadata:u,unpublishTrack:E}}var S=function(e){var t,n,a,c=e.room,i=O(c.localParticipant),o=i.publications,l=i.isMuted,u=i.unpublishTrack,d=o.find((function(e){return e.kind===s.Track.Kind.Audio})),m=o.find((function(e){return e.kind===s.Track.Kind.Video&&"screen"!==e.trackName})),f=o.find((function(e){return e.kind===s.Track.Kind.Video&&"screen"===e.trackName}));return t=!d||l?r.a.createElement(h,{label:"Unmute",onClick:function(){try{var e=function(){if(!d)return Promise.resolve(Object(s.createLocalAudioTrack)()).then((function(e){c.localParticipant.publishTrack(e)}));d.unmute()}();return Promise.resolve(e&&e.then?e.then((function(){})):void 0)}catch(t){return Promise.reject(t)}}}):r.a.createElement(h,{label:"Mute",onClick:function(){return d.mute()}}),n=null!==m&&void 0!==m&&m.track?r.a.createElement(h,{label:"Stop video",onClick:function(){return u(m.track)}}):r.a.createElement(h,{label:"Start video",onClick:function(){try{return Promise.resolve(Object(s.createLocalVideoTrack)()).then((function(e){c.localParticipant.publishTrack(e)}))}catch(e){return Promise.reject(e)}}}),a=null!==f&&void 0!==f&&f.track?r.a.createElement(h,{label:"Stop sharing",onClick:function(){return u(f.track)}}):r.a.createElement(h,{label:"Share screen",onClick:function(){try{var e=E((function(){return Promise.resolve(navigator.mediaDevices.getDisplayMedia({video:{width:s.VideoPresets.fhd.resolution.width,height:s.VideoPresets.fhd.resolution.height}})).then((function(e){c.localParticipant.publishTrack(e.getTracks()[0],{name:"screen",videoEncoding:{maxBitrate:3e6,maxFramerate:30}})}))}),(function(){}));return Promise.resolve(e&&e.then?e.then((function(){})):void 0)}catch(t){return Promise.reject(t)}}}),r.a.createElement("div",{className:k},t,n,a,r.a.createElement(h,{label:"Leave",onClick:function(){return c.disconnect()}}))},g=function(e){var t,n=e.track,c=e.isLocal,i=e.className,o=e.width,l=e.height,u=Object(a.useRef)(null);Object(a.useEffect)((function(){var e=u.current;if(e)return e.muted=!0,n.attach(e),function(){n.detach(e)}}),[n,u]);var s="environment"!==(null===(t=n.mediaStreamTrack)||void 0===t?void 0:t.getSettings().facingMode),d={transform:c&&s?"rotateY(180deg)":"",width:o,height:l};return r.a.createElement("video",{ref:u,className:null!=i?i:f,style:d})},j=function(e){var t=e.participant,n=e.width,c=e.height,i=e.aspect,o=e.displayName,l=e.showOverlay,u=e.onMouseOver,d=e.onMouseOut,f=e.onClick,k=O(t),p=k.isLocal,h=k.subscribedTracks,E=Object(a.useState)(),S=E[0],j=E[1],T=Object(a.useState)(),P=T[0],y=T[1];Object(a.useEffect)((function(){var e=!1,t=!1;h.forEach((function(n){n.kind!==s.Track.Kind.Audio||t||(t=!0,y(n.track)),n.kind!==s.Track.Kind.Video||e||(e=!0,j(n.track))}))}),[h]);var C={width:n,height:c};return i||(i="16 / 9"),n&&void 0===c&&(C.aspectRatio=i),o||(o=t.identity,p&&(o+=" (You)")),r.a.createElement("div",{className:v,style:C,onMouseOver:u,onMouseOut:d,onClick:f},P&&r.a.createElement(m,{track:P,isLocal:p}),S&&r.a.createElement(g,{track:S,isLocal:p,width:"100%",height:"100%"}),l&&r.a.createElement("div",{className:b},o))},T="_2sm4e",P="_2VE66",y="_2kKDi",C="_gA0MQ",L="_1smc2",R=function(e){var t=e.roomState,n=e.participantRenderer,c=e.controlRenderer,i=t.isConnecting,o=t.error,l=t.participants,u=t.room,d=Object(a.useState)(!1),m=d[0],f=d[1];if(o)return r.a.createElement("div",null,"error ",o.message);if(i)return r.a.createElement("div",null,"connecting");if(!u)return r.a.createElement("div",null,"room closed");if(0===l.length)return r.a.createElement("div",null,"no one is in the room");var v,b,k,p=null!=n?n:j,h=null!=c?c:S;return l.forEach((function(e){e instanceof s.LocalParticipant||e.videoTracks.forEach((function(e){"screen"===e.trackName&&e.track&&(v=e.track)}))})),v?(b=l,k=r.a.createElement(g,{track:v,isLocal:!1,height:"100%"})):(console.log("main participant is",l[0].identity),b=l.slice(1),k=r.a.createElement(p,{participant:l[0],height:"100%",showOverlay:m,onMouseOver:function(){return f(!0)},onMouseOut:function(){return f(!1)}})),r.a.createElement("div",{className:T},r.a.createElement("div",{className:P},r.a.createElement("div",{className:y},k),r.a.createElement("div",{className:C},b.map((function(e){return r.a.createElement(p,{key:e.identity,participant:e,width:"100%",showOverlay:m,onMouseOver:function(){return f(!0)},onMouseOut:function(){return f(!1)}})})))),r.a.createElement("div",{className:L},r.a.createElement(h,{room:u})))},w=function(e){return Object(d.useMediaQuery)({query:"(max-width: 800px)"})?null:r.a.createElement(R,Object.assign({},e))};var N=function(e){var t,n=function(){var e=Object(a.useState)(),t=e[0],n=e[1],r=Object(a.useState)(!1),c=r[0],i=r[1],o=Object(a.useState)(),l=o[0],u=o[1],d=Object(a.useState)([]),m=d[0],f=d[1];return{connect:Object(a.useCallback)((function(e,t,a){try{return i(!0),Promise.resolve(E((function(){return Promise.resolve(Object(s.connect)(e,t,a)).then((function(e){n(e);var t=function(){return e.disconnect()},a=function(){var t=Array.from(e.participants.values()),n=[e.localParticipant];n.push.apply(n,t),function(e,t){if(e.sort((function(e,t){var n,a,r,c;if(e.isSpeaking&&t.isSpeaking)return t.audioLevel-e.audioLevel;if(e.isSpeaking!==t.isSpeaking)return e.isSpeaking?-1:1;if(e.lastSpokeAt!==t.lastSpokeAt){var i,o,l,u,s=null!=(i=null===(o=e.lastSpokeAt)||void 0===o?void 0:o.getTime())?i:0;return(null!=(l=null===(u=t.lastSpokeAt)||void 0===u?void 0:u.getTime())?l:0)-s}var d=e.videoTracks.size>0;return d!==t.videoTracks.size>0?d?-1:1:(null!=(n=null===(a=e.joinedAt)||void 0===a?void 0:a.getTime())?n:0)-(null!=(r=null===(c=t.joinedAt)||void 0===c?void 0:c.getTime())?r:0)})),t){var n=e.indexOf(t);n>=0&&(e.splice(n,1),e.length>0?e.splice(1,0,t):e.push(t))}}(n,e.localParticipant),f(n)};return e.once(s.RoomEvent.Disconnected,(function(){setTimeout((function(){return n(void 0)})),window.removeEventListener("beforeunload",t),e.off(s.RoomEvent.ParticipantConnected,a),e.off(s.RoomEvent.ParticipantDisconnected,a),e.off(s.RoomEvent.ActiveSpeakersChanged,a),e.off(s.RoomEvent.TrackSubscribed,a),e.off(s.RoomEvent.TrackUnsubscribed,a)})),e.on(s.RoomEvent.ParticipantConnected,a),e.on(s.RoomEvent.ParticipantDisconnected,a),e.on(s.RoomEvent.ActiveSpeakersChanged,a),e.on(s.RoomEvent.TrackSubscribed,a),e.on(s.RoomEvent.TrackUnsubscribed,a),i(!1),a(),window.addEventListener("beforeunload",t),e}))}),(function(e){i(!1),u(e)})))}catch(r){return Promise.reject(r)}}),[]),isConnecting:c,room:t,error:l,participants:m}}(),r=e.participantRenderer,c=e.controlRenderer;return Object(a.useEffect)((function(){n.connect(e.url,e.token,e.connectOptions).then((function(t){t&&e.onConnected&&e.onConnected(t)}))}),[]),(null!=(t=e.stageRenderer)?t:w)({roomState:n,participantRenderer:r,controlRenderer:c})},M=function(){var e=Object(a.useState)("ws://localhost:7880"),t=Object(u.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(""),o=Object(u.a)(i,2),d=o[0],m=o[1],f=Object(a.useState)(!1),v=Object(u.a)(f,2),b=v[0],k=v[1],p=Object(a.useState)(!1),E=Object(u.a)(p,2),O=E[0],S=E[1],j=Object(a.useState)(!0),T=Object(u.a)(j,2),P=T[0],y=T[1],C=Object(a.useState)(!0),L=Object(u.a)(C,2),R=L[0],w=L[1],N=Object(a.useRef)(null),M=Object(a.useState)(),A=Object(u.a)(M,2),x=A[0],V=A[1],U=Object(l.f)();Object(a.useEffect)((function(){if(N.current&&x){var e=N.current;return x.attach(e),function(){x.detach(e),x.stop()}}}),[x,N]),Object(a.useEffect)((function(){w(!d||!n)}),[d,n]);Object(a.useEffect)((function(){Object(s.createLocalVideoTrack)().then((function(e){S(!0),V(e)}))}),[]);return r.a.createElement("div",{className:"prejoin"},r.a.createElement("main",null,r.a.createElement("h2",null,"LiveKit Video"),r.a.createElement("hr",null),r.a.createElement("div",{className:"entrySection"},r.a.createElement("div",null,r.a.createElement("div",{className:"label"},"LiveKit URL"),r.a.createElement("div",null,r.a.createElement("input",{type:"text",name:"url",value:n,onChange:function(e){return c(e.target.value)}}))),r.a.createElement("div",null,r.a.createElement("div",{className:"label"},"Token"),r.a.createElement("div",null,r.a.createElement("input",{type:"text",name:"token",value:d,onChange:function(e){return m(e.target.value)}}))),r.a.createElement("div",null,r.a.createElement("input",{type:"checkbox",name:"simulcast",checked:b,onChange:function(e){return k(e.target.checked)}}),r.a.createElement("label",null,"Simulcast"))),r.a.createElement("div",{className:"videoSection"},x&&r.a.createElement(g,{track:x,isLocal:!0})),r.a.createElement("div",{className:"controlSection"},r.a.createElement("div",null,r.a.createElement(h,{label:P?"Mute":"Unmute",onClick:function(){y(!P)}}),r.a.createElement(h,{label:x?"Disable Video":"Enable Video",onClick:function(){x?(x.stop(),S(!1),V(void 0)):Object(s.createLocalVideoTrack)().then((function(e){S(!0),V(e)}))}})),r.a.createElement("div",{className:"right"},r.a.createElement(h,{label:"Connect",disabled:R,onClick:function(){var e={url:n,token:d,videoEnabled:O?"1":"0",audioEnabled:P?"1":"0",simulcast:b?"1":"0"};U.push({pathname:"/room",search:"?"+new URLSearchParams(e).toString()})}})))))},A=n(11),x=n.n(A),V=n(61),U=function(){var e=new URLSearchParams(Object(l.g)().search),t=e.get("url"),n=e.get("token");return t&&n?r.a.createElement("div",{className:"roomContainer"},r.a.createElement("h2",null,"LiveKit Video"),r.a.createElement(N,{url:t,token:n,onConnected:function(t){return function(e,t){return K.apply(this,arguments)}(t,e)}})):r.a.createElement("div",null,"url and token are required")};function K(){return(K=Object(V.a)(x.a.mark((function e(t,n){var a,r,c;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("1"!==n.get("audioEnabled")){e.next=6;break}return e.next=3,Object(s.createLocalAudioTrack)();case 3:return a=e.sent,e.next=6,t.localParticipant.publishTrack(a);case 6:if("1"!==n.get("videoEnabled")){e.next=14;break}return r={name:"camera"},"1"===n.get("simulcast")&&(r.simulcast=!0),e.next=11,Object(s.createLocalVideoTrack)();case 11:return c=e.sent,e.next=14,t.localParticipant.publishTrack(c,r);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _=function(){return r.a.createElement("div",{className:"container"},r.a.createElement(o.a,null,r.a.createElement(l.c,null,r.a.createElement(l.a,{path:"/room"},r.a.createElement(U,null)),r.a.createElement(l.a,{path:"/"},r.a.createElement(M,null)))))};i.a.render(r.a.createElement(_,null),document.getElementById("root"))},62:function(e,t,n){e.exports=n(103)},63:function(e,t,n){},68:function(e,t,n){}},[[62,1,2]]]);
//# sourceMappingURL=main.dcbf0fcc.chunk.js.map
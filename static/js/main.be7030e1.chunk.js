(this["webpackJsonplivekit-react-example"]=this["webpackJsonplivekit-react-example"]||[]).push([[0],{153:function(e,t,n){"use strict";n.r(t);n(93);var a=n(0),r=n.n(a),c=n(86),i=n.n(c),o=(n(98),n(38)),u=n(7),l=n(20),s=n(27),d=n(1),m=n(89),f=function(e){var t=e.track,n=e.isLocal,r=Object(a.useRef)();return Object(a.useEffect)((function(){if(!n)return r.current=t.attach(),t.sid&&r.current.setAttribute("data-audio-track-id",t.sid),function(){return t.detach().forEach((function(e){return e.remove()}))}}),[t,n]),null},v="_2WNzJ",b="_34YL4",p="_1k1qr",k="_2kKks",E="_hRq5k",h=function(e){var t=e.label,n=e.disabled,a=e.onClick;return r.a.createElement("button",{disabled:n,className:E,onClick:a},t)};function O(e){var t=Object(a.useState)(!1),n=t[0],r=t[1],c=Object(a.useState)(!1),i=c[0],o=c[1],u=Object(a.useState)(),l=u[0],s=u[1],m=Object(a.useState)([]),f=m[0],v=m[1],b=Object(a.useState)([]),p=b[0],k=b[1],E=Object(a.useCallback)((function(){v(Array.from(e.tracks.values())),k(Array.from(e.tracks.values()).filter((function(e){return void 0!==e.track})))}),[]),h=Object(a.useCallback)((function(t){try{if(!(e instanceof d.LocalParticipant))throw new Error("could not unpublish, not a local participant");return e.unpublishTrack(t),E(),Promise.resolve()}catch(n){return Promise.reject(n)}}),[]);return Object(a.useEffect)((function(){var t=function(e){e.kind===d.Track.Kind.Audio&&r(!0)},n=function(e){e.kind===d.Track.Kind.Audio&&r(!1)},a=function(){e.metadata&&s(e.metadata)},c=function(){o(e.isSpeaking)};return e.on(d.ParticipantEvent.TrackMuted,t),e.on(d.ParticipantEvent.TrackUnmuted,n),e.on(d.ParticipantEvent.MetadataChanged,a),e.on(d.ParticipantEvent.IsSpeakingChanged,c),e.on(d.ParticipantEvent.TrackPublished,E),e.on(d.ParticipantEvent.TrackUnpublished,E),e.on(d.ParticipantEvent.TrackSubscribed,E),e.on(d.ParticipantEvent.TrackUnsubscribed,E),a(),c(),E(),e.audioTracks.forEach((function(e){r(e.isMuted)})),function(){e.off(d.ParticipantEvent.TrackMuted,t),e.off(d.ParticipantEvent.TrackUnmuted,n),e.off(d.ParticipantEvent.MetadataChanged,a),e.off(d.ParticipantEvent.IsSpeakingChanged,c),e.off(d.ParticipantEvent.TrackPublished,E),e.off(d.ParticipantEvent.TrackUnpublished,E),e.off(d.ParticipantEvent.TrackSubscribed,E),e.off(d.ParticipantEvent.TrackUnsubscribed,E)}}),[]),{isLocal:e instanceof d.LocalParticipant,isSpeaking:i,isMuted:n,publications:f,subscribedTracks:p,metadata:l,unpublishTrack:h}}var S=function(e){var t,n,a=e.room,c=O(a.localParticipant),i=c.publications,o=c.isMuted,u=c.unpublishTrack,l=i.find((function(e){return e.kind===d.Track.Kind.Audio})),s=i.find((function(e){return e.kind===d.Track.Kind.Video&&"screen"!==e.trackName}));return t=!l||o?r.a.createElement(h,{label:"Unmute",onClick:function(){try{var e=function(){if(!l)return Promise.resolve(Object(d.createLocalAudioTrack)()).then((function(e){a.localParticipant.publishTrack(e)}));l.unmute()}();return Promise.resolve(e&&e.then?e.then((function(){})):void 0)}catch(t){return Promise.reject(t)}}}):r.a.createElement(h,{label:"Mute",onClick:function(){return l.mute()}}),n=null!==s&&void 0!==s&&s.track?r.a.createElement(h,{label:"Stop video",onClick:function(){return u(s.track)}}):r.a.createElement(h,{label:"Start video",onClick:function(){try{return Promise.resolve(Object(d.createLocalVideoTrack)()).then((function(e){return Promise.resolve(a.localParticipant.publishTrack(e)).then((function(){}))}))}catch(e){return Promise.reject(e)}}}),r.a.createElement("div",{className:k},t,n,r.a.createElement(h,{label:"Leave",onClick:function(){return a.disconnect()}}))},j=function(e){var t,n=e.track,c=e.isLocal,i=e.className,o=e.width,u=e.height,l=Object(a.useRef)(null);Object(a.useEffect)((function(){var e=l.current;if(e)return e.muted=!0,n.attach(e),function(){n.detach(e)}}),[n]);var s="environment"!==(null===(t=n.mediaStreamTrack)||void 0===t?void 0:t.getSettings().facingMode),d={transform:c&&s?"rotateY(180deg)":"",width:o,height:u};return r.a.createElement("video",{ref:l,className:null!=i?i:v,style:d})},g=function(e){var t,n,a=e.participant,c=e.width,i=e.height,o=e.aspect,u=e.displayName,l=e.showOverlay,s=e.onMouseOver,m=e.onMouseOut,v=O(a),k=v.isLocal;v.subscribedTracks.forEach((function(e){e.kind!==d.Track.Kind.Audio||t||(t=e.track),e.kind!==d.Track.Kind.Video||n||(n=e.track)}));var E={width:c,height:i};return o||(o="16 / 9"),c&&void 0===i&&(E.aspectRatio=o),u||(u=a.identity,k&&(u+=" (You)")),r.a.createElement("div",{className:b,style:E,onMouseOver:s,onMouseOut:m},t&&r.a.createElement(f,{track:t,isLocal:k}),n&&r.a.createElement(j,{track:n,isLocal:k,width:"100%",height:"100%"}),l&&r.a.createElement("div",{className:p},u))},P="_2sm4e",T="_2VE66",y="_2kKDi",C="_gA0MQ",L="_1smc2",w=function(e){var t=e.roomState,n=e.participantRenderer,c=t.isConnecting,i=t.error,o=t.participants,u=t.room,l=Object(a.useState)(!1),s=l[0],d=l[1];if(i)return r.a.createElement("div",null,"error ",i.message);if(c)return r.a.createElement("div",null,"connecting");if(!u)return r.a.createElement("div",null,"room closed");if(0===o.length)return r.a.createElement("div",null,"no one is in the room");for(var m=o[0],f=o.slice(1),v=8-f.length,b=0;b<v;b++)f.push(m);var p=null!=n?n:g;return r.a.createElement("div",{className:P},r.a.createElement("div",{className:T},r.a.createElement("div",{className:y},r.a.createElement(p,{participant:m,height:"100%",showOverlay:s,onMouseOver:function(){return d(!0)},onMouseOut:function(){return d(!1)}})),r.a.createElement("div",{className:C},f.map((function(e){return r.a.createElement(p,{key:e.identity,participant:e,width:"100%",showOverlay:s,onMouseOver:function(){return d(!0)},onMouseOut:function(){return d(!1)}})})))),r.a.createElement("div",{className:L},r.a.createElement(S,{room:u})))},N=function(e){return Object(m.useMediaQuery)({query:"(max-width: 800px)"})?null:r.a.createElement(w,Object.assign({},e))};"undefined"!==typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!==typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var M=function(e){var t,n=function(){var e=Object(a.useState)(),t=e[0],n=e[1],r=Object(a.useState)(!1),c=r[0],i=r[1],o=Object(a.useState)(),u=o[0],l=o[1],s=Object(a.useState)([]),m=s[0],f=s[1];return{connect:Object(a.useCallback)((function(e,t,a){try{return i(!0),Promise.resolve(function(e,t){try{var n=e()}catch(a){return t(a)}return n&&n.then?n.then(void 0,t):n}((function(){return Promise.resolve(Object(d.connect)(e,t,a)).then((function(e){n(e);var t=function(){return e.disconnect()},a=function(){var t=Array.from(e.participants.values()),n=[e.localParticipant];n.push.apply(n,t),function(e,t){if(e.sort((function(e,t){var n,a,r,c;if(e.isSpeaking&&t.isSpeaking)return t.audioLevel-e.audioLevel;if(e.isSpeaking!==t.isSpeaking)return e.isSpeaking?-1:1;if(e.lastSpokeAt!==t.lastSpokeAt){var i,o,u,l,s=null!=(i=null===(o=e.lastSpokeAt)||void 0===o?void 0:o.getTime())?i:0;return(null!=(u=null===(l=t.lastSpokeAt)||void 0===l?void 0:l.getTime())?u:0)-s}var d=e.videoTracks.size>0;return d!==t.videoTracks.size>0?d?-1:1:(null!=(n=null===(a=e.joinedAt)||void 0===a?void 0:a.getTime())?n:0)-(null!=(r=null===(c=t.joinedAt)||void 0===c?void 0:c.getTime())?r:0)})),t){var n=e.indexOf(t);n>=0&&(e.splice(n,1),e.length>0?e.splice(1,0,t):e.push(t))}}(n,e.localParticipant),f(n)};return e.once(d.RoomEvent.Disconnected,(function(){setTimeout((function(){return n(void 0)})),window.removeEventListener("beforeunload",t),e.off(d.RoomEvent.ParticipantConnected,a),e.off(d.RoomEvent.ParticipantDisconnected,a),e.off(d.RoomEvent.ActiveSpeakersChanged,a)})),e.on(d.RoomEvent.ParticipantConnected,a),e.on(d.RoomEvent.ParticipantDisconnected,a),e.on(d.RoomEvent.ActiveSpeakersChanged,a),i(!1),a(),window.addEventListener("beforeunload",t),e}))}),(function(e){i(!1),l(e)})))}catch(r){return Promise.reject(r)}}),[]),isConnecting:c,room:t,error:u,participants:m}}();return Object(a.useEffect)((function(){n.connect(e.url,e.token,e.connectOptions).then((function(t){t&&e.onConnected&&e.onConnected(t)}))}),[]),(null!=(t=e.stageRenderer)?t:N)({roomState:n})},A=function(){var e=Object(a.useState)("ws://localhost:7880"),t=Object(l.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(""),o=Object(l.a)(i,2),d=o[0],m=o[1],f=Object(a.useState)(!1),v=Object(l.a)(f,2),b=v[0],p=v[1],k=Object(a.useState)(!1),E=Object(l.a)(k,2),O=E[0],S=E[1],g=Object(a.useState)(!1),P=Object(l.a)(g,2),T=P[0],y=P[1],C=Object(a.useState)(!0),L=Object(l.a)(C,2),w=L[0],N=L[1],M=Object(a.useRef)(null),A=Object(a.useState)(),R=Object(l.a)(A,2),x=R[0],K=R[1],U=Object(u.f)();Object(a.useEffect)((function(){if(M.current&&x){var e=M.current;return x.attach(e),function(){x.detach(e),x.stop()}}}),[x,M]),Object(a.useEffect)((function(){N(!d||!n)}),[d,n]);Object(a.useEffect)((function(){Object(s.createLocalVideoTrack)().then((function(e){S(!0),K(e)}))}),[]);return r.a.createElement("div",{className:"prejoin"},r.a.createElement("main",null,r.a.createElement("h2",null,"LiveKit Video"),r.a.createElement("hr",null),r.a.createElement("div",{className:"entrySection"},r.a.createElement("div",null,r.a.createElement("div",{className:"label"},"LiveKit URL"),r.a.createElement("div",null,r.a.createElement("input",{type:"text",name:"url",value:n,onChange:function(e){return c(e.target.value)}}))),r.a.createElement("div",null,r.a.createElement("div",{className:"label"},"Token"),r.a.createElement("div",null,r.a.createElement("input",{type:"text",name:"token",value:d,onChange:function(e){return m(e.target.value)}}))),r.a.createElement("div",null,r.a.createElement("input",{type:"checkbox",name:"simulcast",checked:b,onChange:function(e){return p(e.target.checked)}}),r.a.createElement("label",null,"Simulcast"))),r.a.createElement("div",{className:"videoSection"},x&&r.a.createElement(j,{track:x,isLocal:!0})),r.a.createElement("div",{className:"controlSection"},r.a.createElement("div",null,r.a.createElement(h,{label:T?"Mute":"Unmute",onClick:function(){y(!T)}}),r.a.createElement(h,{label:x?"Disable Video":"Enable Video",onClick:function(){x?(x.stop(),S(!1),K(void 0)):Object(s.createLocalVideoTrack)().then((function(e){S(!0),K(e)}))}})),r.a.createElement("div",{className:"right"},r.a.createElement(h,{label:"Connect",disabled:w,onClick:function(){var e={url:n,token:d,videoEnabled:O?"1":"0",audioEnabled:T?"1":"0",simulcast:b?"1":"0"};U.push({pathname:"/room",search:"?"+new URLSearchParams(e).toString()})}})))))},R=n(6),x=n.n(R),K=n(91),U=function(){var e=new URLSearchParams(Object(u.g)().search),t=e.get("url"),n=e.get("token");return t&&n?r.a.createElement("div",{className:"roomContainer"},r.a.createElement("h2",null,"LiveKit Video"),r.a.createElement(M,{url:t,token:n,onConnected:function(t){return function(e,t){return V.apply(this,arguments)}(t,e)}})):r.a.createElement("div",null,"url and token are required")};function V(){return(V=Object(K.a)(x.a.mark((function e(t,n){var a,r,c;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("1"!==n.get("audioEnabled")){e.next=6;break}return e.next=3,Object(s.createLocalAudioTrack)();case 3:return a=e.sent,e.next=6,t.localParticipant.publishTrack(a);case 6:if("1"!==n.get("videoEnabled")){e.next=14;break}return r={name:"camera"},"1"===n.get("simulcast")&&(r.simulcast=!0),e.next=11,Object(s.createLocalVideoTrack)();case 11:return c=e.sent,e.next=14,t.localParticipant.publishTrack(c,r);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _=function(){return r.a.createElement("div",{className:"container"},r.a.createElement(o.a,null,r.a.createElement(u.c,null,r.a.createElement(u.a,{path:"/room"},r.a.createElement(U,null)),r.a.createElement(u.a,{path:"/"},r.a.createElement(A,null)))))};i.a.render(r.a.createElement(_,null),document.getElementById("root"))},92:function(e,t,n){e.exports=n(153)},93:function(e,t,n){},98:function(e,t,n){}},[[92,1,2]]]);
//# sourceMappingURL=main.be7030e1.chunk.js.map
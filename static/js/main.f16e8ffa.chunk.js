(this["webpackJsonplivekit-react-example"]=this["webpackJsonplivekit-react-example"]||[]).push([[0],{153:function(e,t,n){"use strict";n.r(t);n(93);var a=n(0),r=n.n(a),c=n(86),i=n.n(c),o=(n(98),n(38)),l=n(7),u=n(20),s=n(27),d=n(1),m=n(89),f=function(e){var t=e.track,n=e.isLocal,r=Object(a.useRef)();return Object(a.useEffect)((function(){if(!n)return r.current=t.attach(),t.sid&&r.current.setAttribute("data-audio-track-id",t.sid),function(){return t.detach().forEach((function(e){return e.remove()}))}}),[t,n]),null},v="_2WNzJ",b="_34YL4",k="_1k1qr",p="_2kKks",h="_hRq5k",E=function(e){var t=e.label,n=e.disabled,a=e.onClick;return r.a.createElement("button",{disabled:n,className:h,onClick:a},t)};"undefined"!==typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!==typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));function g(e,t){try{var n=e()}catch(a){return t(a)}return n&&n.then?n.then(void 0,t):n}function O(e){var t=Object(a.useState)(!1),n=t[0],r=t[1],c=Object(a.useState)(!1),i=c[0],o=c[1],l=Object(a.useState)(),u=l[0],s=l[1],m=Object(a.useState)([]),f=m[0],v=m[1],b=Object(a.useState)([]),k=b[0],p=b[1],h=Object(a.useCallback)((function(){v(Array.from(e.tracks.values())),p(Array.from(e.tracks.values()).filter((function(e){return void 0!==e.track})))}),[]),E=Object(a.useCallback)((function(t){try{if(!(e instanceof d.LocalParticipant))throw new Error("could not unpublish, not a local participant");return e.unpublishTrack(t),h(),Promise.resolve()}catch(n){return Promise.reject(n)}}),[]);return Object(a.useEffect)((function(){var t=function(e){e.kind===d.Track.Kind.Audio&&r(!0)},n=function(e){e.kind===d.Track.Kind.Audio&&r(!1)},a=function(){e.metadata&&s(e.metadata)},c=function(){o(e.isSpeaking)};return e.on(d.ParticipantEvent.TrackMuted,t),e.on(d.ParticipantEvent.TrackUnmuted,n),e.on(d.ParticipantEvent.MetadataChanged,a),e.on(d.ParticipantEvent.IsSpeakingChanged,c),e.on(d.ParticipantEvent.TrackPublished,h),e.on(d.ParticipantEvent.TrackUnpublished,h),e.on(d.ParticipantEvent.TrackSubscribed,h),e.on(d.ParticipantEvent.TrackUnsubscribed,h),a(),c(),h(),e.audioTracks.forEach((function(e){r(e.isMuted)})),function(){e.off(d.ParticipantEvent.TrackMuted,t),e.off(d.ParticipantEvent.TrackUnmuted,n),e.off(d.ParticipantEvent.MetadataChanged,a),e.off(d.ParticipantEvent.IsSpeakingChanged,c),e.off(d.ParticipantEvent.TrackPublished,h),e.off(d.ParticipantEvent.TrackUnpublished,h),e.off(d.ParticipantEvent.TrackSubscribed,h),e.off(d.ParticipantEvent.TrackUnsubscribed,h)}}),[]),{isLocal:e instanceof d.LocalParticipant,isSpeaking:i,isMuted:n,publications:f,subscribedTracks:k,metadata:u,unpublishTrack:E}}var S=function(e){var t,n,a,c=e.room,i=O(c.localParticipant),o=i.publications,l=i.isMuted,u=i.unpublishTrack,s=o.find((function(e){return e.kind===d.Track.Kind.Audio})),m=o.find((function(e){return e.kind===d.Track.Kind.Video&&"screen"!==e.trackName})),f=o.find((function(e){return e.kind===d.Track.Kind.Video&&"screen"===e.trackName}));return t=!s||l?r.a.createElement(E,{label:"Unmute",onClick:function(){try{var e=function(){if(!s)return Promise.resolve(Object(d.createLocalAudioTrack)()).then((function(e){c.localParticipant.publishTrack(e)}));s.unmute()}();return Promise.resolve(e&&e.then?e.then((function(){})):void 0)}catch(t){return Promise.reject(t)}}}):r.a.createElement(E,{label:"Mute",onClick:function(){return s.mute()}}),n=null!==m&&void 0!==m&&m.track?r.a.createElement(E,{label:"Stop video",onClick:function(){return u(m.track)}}):r.a.createElement(E,{label:"Start video",onClick:function(){try{return Promise.resolve(Object(d.createLocalVideoTrack)()).then((function(e){c.localParticipant.publishTrack(e)}))}catch(e){return Promise.reject(e)}}}),a=null!==f&&void 0!==f&&f.track?r.a.createElement(E,{label:"Stop sharing",onClick:function(){return u(f.track)}}):r.a.createElement(E,{label:"Share screen",onClick:function(){try{var e=g((function(){return Promise.resolve(navigator.mediaDevices.getDisplayMedia({video:{width:d.VideoPresets.fhd.resolution.width,height:d.VideoPresets.fhd.resolution.height}})).then((function(e){c.localParticipant.publishTrack(e.getTracks()[0],{name:"screen",videoEncoding:{maxBitrate:3e6,maxFramerate:30}})}))}),(function(){}));return Promise.resolve(e&&e.then?e.then((function(){})):void 0)}catch(t){return Promise.reject(t)}}}),r.a.createElement("div",{className:p},t,n,a,r.a.createElement(E,{label:"Leave",onClick:function(){return c.disconnect()}}))},j=function(e){var t,n=e.track,c=e.isLocal,i=e.className,o=e.width,l=e.height,u=Object(a.useRef)(null);Object(a.useEffect)((function(){var e=u.current;if(e)return e.muted=!0,console.log("attaching track to video",n,e),n.attach(e),function(){console.log("detaching track from video",n,e),n.detach(e)}}),[n,u]);var s="environment"!==(null===(t=n.mediaStreamTrack)||void 0===t?void 0:t.getSettings().facingMode),d={transform:c&&s?"rotateY(180deg)":"",width:o,height:l};return r.a.createElement("video",{ref:u,className:null!=i?i:v,style:d})},T=function(e){var t=e.participant,n=e.width,c=e.height,i=e.aspect,o=e.displayName,l=e.showOverlay,u=e.onMouseOver,s=e.onMouseOut,m=e.onClick,v=O(t),p=v.isLocal,h=v.subscribedTracks,E=Object(a.useState)(),g=E[0],S=E[1],T=Object(a.useState)(),P=T[0],y=T[1];Object(a.useEffect)((function(){var e=!1,t=!1;h.forEach((function(n){n.kind!==d.Track.Kind.Audio||t||(t=!0,y(n.track)),n.kind!==d.Track.Kind.Video||e||(e=!0,S(n.track))}))}),[h]);var C={width:n,height:c};return i||(i="16 / 9"),n&&void 0===c&&(C.aspectRatio=i),o||(o=t.identity,p&&(o+=" (You)")),r.a.createElement("div",{className:b,style:C,onMouseOver:u,onMouseOut:s,onClick:m},P&&r.a.createElement(f,{track:P,isLocal:p}),g&&r.a.createElement(j,{track:g,isLocal:p,width:"100%",height:"100%"}),l&&r.a.createElement("div",{className:k},o))},P="_2sm4e",y="_2VE66",C="_2kKDi",L="_gA0MQ",R="_1smc2",w=function(e){var t=e.roomState,n=e.participantRenderer,c=e.controlRenderer,i=t.isConnecting,o=t.error,l=t.participants,u=t.room,s=Object(a.useState)(!1),m=s[0],f=s[1];if(o)return r.a.createElement("div",null,"error ",o.message);if(i)return r.a.createElement("div",null,"connecting");if(!u)return r.a.createElement("div",null,"room closed");if(0===l.length)return r.a.createElement("div",null,"no one is in the room");var v,b,k,p=null!=n?n:T,h=null!=c?c:S;return l.forEach((function(e){e instanceof d.LocalParticipant||e.videoTracks.forEach((function(e){"screen"===e.trackName&&e.track&&(v=e.track)}))})),v?(b=l,k=r.a.createElement(j,{track:v,isLocal:!1,height:"100%"})):(b=l.slice(1),k=r.a.createElement(p,{participant:l[0],height:"100%",showOverlay:m,onMouseOver:function(){return f(!0)},onMouseOut:function(){return f(!1)}})),r.a.createElement("div",{className:P},r.a.createElement("div",{className:y},r.a.createElement("div",{className:C},k),r.a.createElement("div",{className:L},b.map((function(e){return r.a.createElement(p,{key:e.identity,participant:e,width:"100%",showOverlay:m,onMouseOver:function(){return f(!0)},onMouseOut:function(){return f(!1)}})})))),r.a.createElement("div",{className:R},r.a.createElement(h,{room:u})))},N=function(e){return Object(m.useMediaQuery)({query:"(max-width: 800px)"})?null:r.a.createElement(w,Object.assign({},e))};var M=function(e){var t,n=function(){var e=Object(a.useState)(),t=e[0],n=e[1],r=Object(a.useState)(!1),c=r[0],i=r[1],o=Object(a.useState)(),l=o[0],u=o[1],s=Object(a.useState)([]),m=s[0],f=s[1];return{connect:Object(a.useCallback)((function(e,t,a){try{return i(!0),Promise.resolve(g((function(){return Promise.resolve(Object(d.connect)(e,t,a)).then((function(e){n(e);var t=function(){return e.disconnect()},a=function(){var t=Array.from(e.participants.values()),n=[e.localParticipant];n.push.apply(n,t),function(e,t){if(e.sort((function(e,t){var n,a,r,c;if(e.isSpeaking&&t.isSpeaking)return t.audioLevel-e.audioLevel;if(e.isSpeaking!==t.isSpeaking)return e.isSpeaking?-1:1;if(e.lastSpokeAt!==t.lastSpokeAt){var i,o,l,u,s=null!=(i=null===(o=e.lastSpokeAt)||void 0===o?void 0:o.getTime())?i:0;return(null!=(l=null===(u=t.lastSpokeAt)||void 0===u?void 0:u.getTime())?l:0)-s}var d=e.videoTracks.size>0;return d!==t.videoTracks.size>0?d?-1:1:(null!=(n=null===(a=e.joinedAt)||void 0===a?void 0:a.getTime())?n:0)-(null!=(r=null===(c=t.joinedAt)||void 0===c?void 0:c.getTime())?r:0)})),t){var n=e.indexOf(t);n>=0&&(e.splice(n,1),e.length>0?e.splice(1,0,t):e.push(t))}}(n,e.localParticipant),f(n)};return e.once(d.RoomEvent.Disconnected,(function(){setTimeout((function(){return n(void 0)})),window.removeEventListener("beforeunload",t),e.off(d.RoomEvent.ParticipantConnected,a),e.off(d.RoomEvent.ParticipantDisconnected,a),e.off(d.RoomEvent.ActiveSpeakersChanged,a),e.off(d.RoomEvent.TrackSubscribed,a),e.off(d.RoomEvent.TrackUnsubscribed,a)})),e.on(d.RoomEvent.ParticipantConnected,a),e.on(d.RoomEvent.ParticipantDisconnected,a),e.on(d.RoomEvent.ActiveSpeakersChanged,a),e.on(d.RoomEvent.TrackSubscribed,a),e.on(d.RoomEvent.TrackUnsubscribed,a),i(!1),a(),window.addEventListener("beforeunload",t),e}))}),(function(e){i(!1),u(e)})))}catch(r){return Promise.reject(r)}}),[]),isConnecting:c,room:t,error:l,participants:m}}(),r=e.participantRenderer,c=e.controlRenderer;return Object(a.useEffect)((function(){n.connect(e.url,e.token,e.connectOptions).then((function(t){t&&e.onConnected&&e.onConnected(t)}))}),[]),(null!=(t=e.stageRenderer)?t:N)({roomState:n,participantRenderer:r,controlRenderer:c})},A=function(){var e=Object(a.useState)("ws://localhost:7880"),t=Object(u.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(""),o=Object(u.a)(i,2),d=o[0],m=o[1],f=Object(a.useState)(!1),v=Object(u.a)(f,2),b=v[0],k=v[1],p=Object(a.useState)(!1),h=Object(u.a)(p,2),g=h[0],O=h[1],S=Object(a.useState)(!1),T=Object(u.a)(S,2),P=T[0],y=T[1],C=Object(a.useState)(!0),L=Object(u.a)(C,2),R=L[0],w=L[1],N=Object(a.useRef)(null),M=Object(a.useState)(),A=Object(u.a)(M,2),x=A[0],V=A[1],U=Object(l.f)();Object(a.useEffect)((function(){if(N.current&&x){var e=N.current;return x.attach(e),function(){x.detach(e),x.stop()}}}),[x,N]),Object(a.useEffect)((function(){w(!d||!n)}),[d,n]);Object(a.useEffect)((function(){Object(s.createLocalVideoTrack)().then((function(e){O(!0),V(e)}))}),[]);return r.a.createElement("div",{className:"prejoin"},r.a.createElement("main",null,r.a.createElement("h2",null,"LiveKit Video"),r.a.createElement("hr",null),r.a.createElement("div",{className:"entrySection"},r.a.createElement("div",null,r.a.createElement("div",{className:"label"},"LiveKit URL"),r.a.createElement("div",null,r.a.createElement("input",{type:"text",name:"url",value:n,onChange:function(e){return c(e.target.value)}}))),r.a.createElement("div",null,r.a.createElement("div",{className:"label"},"Token"),r.a.createElement("div",null,r.a.createElement("input",{type:"text",name:"token",value:d,onChange:function(e){return m(e.target.value)}}))),r.a.createElement("div",null,r.a.createElement("input",{type:"checkbox",name:"simulcast",checked:b,onChange:function(e){return k(e.target.checked)}}),r.a.createElement("label",null,"Simulcast"))),r.a.createElement("div",{className:"videoSection"},x&&r.a.createElement(j,{track:x,isLocal:!0})),r.a.createElement("div",{className:"controlSection"},r.a.createElement("div",null,r.a.createElement(E,{label:P?"Mute":"Unmute",onClick:function(){y(!P)}}),r.a.createElement(E,{label:x?"Disable Video":"Enable Video",onClick:function(){x?(x.stop(),O(!1),V(void 0)):Object(s.createLocalVideoTrack)().then((function(e){O(!0),V(e)}))}})),r.a.createElement("div",{className:"right"},r.a.createElement(E,{label:"Connect",disabled:R,onClick:function(){var e={url:n,token:d,videoEnabled:g?"1":"0",audioEnabled:P?"1":"0",simulcast:b?"1":"0"};U.push({pathname:"/room",search:"?"+new URLSearchParams(e).toString()})}})))))},x=n(6),V=n.n(x),U=n(91),K=function(){var e=new URLSearchParams(Object(l.g)().search),t=e.get("url"),n=e.get("token");return t&&n?r.a.createElement("div",{className:"roomContainer"},r.a.createElement("h2",null,"LiveKit Video"),r.a.createElement(M,{url:t,token:n,onConnected:function(t){return function(e,t){return _.apply(this,arguments)}(t,e)}})):r.a.createElement("div",null,"url and token are required")};function _(){return(_=Object(U.a)(V.a.mark((function e(t,n){var a,r,c;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("1"!==n.get("audioEnabled")){e.next=6;break}return e.next=3,Object(s.createLocalAudioTrack)();case 3:return a=e.sent,e.next=6,t.localParticipant.publishTrack(a);case 6:if("1"!==n.get("videoEnabled")){e.next=14;break}return r={name:"camera"},"1"===n.get("simulcast")&&(r.simulcast=!0),e.next=11,Object(s.createLocalVideoTrack)();case 11:return c=e.sent,e.next=14,t.localParticipant.publishTrack(c,r);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var D=function(){return r.a.createElement("div",{className:"container"},r.a.createElement(o.a,null,r.a.createElement(l.c,null,r.a.createElement(l.a,{path:"/room"},r.a.createElement(K,null)),r.a.createElement(l.a,{path:"/"},r.a.createElement(A,null)))))};i.a.render(r.a.createElement(D,null),document.getElementById("root"))},92:function(e,t,n){e.exports=n(153)},93:function(e,t,n){},98:function(e,t,n){}},[[92,1,2]]]);
//# sourceMappingURL=main.f16e8ffa.chunk.js.map